- name: tests
  service: web
  command: lein midje

- name: Push to GCR (dev)
  tag: development
  service: web
  type: push
  image_name: gcr.io/ovation-io/webapi
  image_tag: "development-{{ .Timestamp }}"
  registry: https://gcr.io
  dockercfg_service: gcr_dockercfg

- name: Push to GCR (prod)
  tag: master
  service: web
  type: push
  image_name: gcr.io/ovation-io/webapi
  image_tag: "production-{{ .Timestamp }}"
  registry: https://gcr.io
  dockercfg_service: gcr_dockercfg


- name: Deploy (dev)
  tag: development
  service: gke-deploy
  command: deploy/deploy.sh development

- name: Deploy (prod)
  tag: master
  service: gke-deploy
  command: deploy/deploy.sh production
